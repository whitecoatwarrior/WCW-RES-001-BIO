<meta name='viewport' content='width=device-width, initial-scale=1'/><meta name='viewport' content='width=device-width, initial-scale=1'/><meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WHITE COAT WARRIORS</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* All CSS styles remain the same as in the original file */
        :root {
            --primary-blue: #1a56db;
            --secondary-blue: #0ea5e9;
            --dark-blue: #1e3a8a;
            --light-blue: #dbeafe;
            --accent-green: #10b981;
            --accent-orange: #f59e0b;
            --accent-red: #ef4444;
            --accent-purple: #8b5cf6;
            --accent-pink: #ec4899;
            --accent-teal: #14b8a6;
            --accent-yellow: #fbbf24;
            --accent-amber: #f59e0b;
            --vibrant-blue: #3b82f6;
            --vibrant-green: #22c55e;
            --vibrant-purple: #a855f7;
            --vibrant-pink: #e879f9;
            --gradient-blue: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
            --gradient-green: linear-gradient(135deg, var(--accent-green), #34d399);
            --gradient-orange: linear-gradient(135deg, var(--accent-orange), #f97316);
            --gradient-red: linear-gradient(135deg, var(--accent-red), #f87171);
            --gradient-purple: linear-gradient(135deg, var(--accent-purple), #a78bfa);
            --gradient-pink: linear-gradient(135deg, var(--accent-pink), #f472b6);
            --gradient-teal: linear-gradient(135deg, var(--accent-teal), #2dd4bf);
            --gradient-yellow: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
            --gradient-vibrant: linear-gradient(135deg, #4f46e5, #7c3aed, #ec4899);
            --shadow: 0 1px 2px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 2px 5px rgba(0, 0, 0, 0.08);
            --shadow-xl: 0 5px 15px -3px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 6px;
            color: #1e3a8a;
            font-size: 8.25px;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            position: relative;
        }

        .logo {
            text-align: center;
            margin-bottom: 9px;
        }

        .logo h1 {
            font-size: 1.05rem;
            font-weight: 800;
            color: var(--dark-blue);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.08);
            margin-bottom: 1.5px;
            background: var(--gradient-vibrant);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo p {
            color: var(--primary-blue);
            font-weight: 600;
            font-size: 0.525rem;
        }

        .page {
            background: white;
            border-radius: 9px;
            padding: 9px;
            box-shadow: var(--shadow-xl);
            width: 100%;
            display: none;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: linear-gradient(to bottom right, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
            backdrop-filter: blur(10px);
        }

        .active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(6px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .promo-banner {
            background: var(--gradient-vibrant);
            color: white;
            padding: 11.25px;
            border-radius: 7.5px;
            margin-bottom: 11.25px;
            text-align: center;
            font-size: 0.45rem;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        .promo-banner::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 100%);
            z-index: 1;
        }

        .promo-banner h2 {
            font-size: 0.675rem;
            margin-bottom: 6px;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            position: relative;
            z-index: 2;
        }

        .promo-banner p {
            line-height: 1.4;
            text-align: justify;
            position: relative;
            z-index: 2;
        }

        .form-group {
            margin-bottom: 6px;
        }

        .form-label {
            display: block;
            margin-bottom: 1.5px;
            font-weight: 600;
            color: var(--dark-blue);
            font-size: 0.525rem;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 4.5px 6.75px;
            border: 1.5px solid var(--light-blue);
            border-radius: 3.75px;
            font-size: 0.525rem;
            background: #f8fafc;
            transition: all 0.2s;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 2px rgba(26, 86, 219, 0.15);
        }

        .input-container {
            position: relative;
        }

        .password-container .form-input {
            padding-right: 22.5px;
        }

        .input-icon {
            position: absolute;
            right: 7.5px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-blue);
            font-size: 0.525rem;
            cursor: pointer;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 4.5px 7.5px;
            border: none;
            border-radius: 6px;
            font-weight: 700;
            font-size: 0.525rem;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            gap: 3px;
            width: 100%;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: var(--gradient-blue);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(26, 86, 219, 0.2);
        }

        .btn-contact {
            background: var(--gradient-green);
            color: white;
        }

        .btn-contact:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(16, 185, 129, 0.2);
        }

        .btn-whatsapp {
            background: linear-gradient(135deg, #25d366, #128c7e);
            color: white;
        }

        .btn-whatsapp:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(37, 211, 102, 0.2);
        }

        .btn-purple {
            background: var(--gradient-purple);
            color: white;
        }

        .btn-purple:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(139, 92, 246, 0.2);
        }

        .btn-red {
            background: var(--gradient-red);
            color: white;
        }

        .btn-red:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(239, 68, 68, 0.2);
        }

        .btn-orange {
            background: var(--gradient-orange);
            color: white;
        }

        .btn-orange:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(245, 158, 11, 0.2);
        }

        .error-box {
            background: #fee2e2;
            color: var(--accent-red);
            padding: 3.75px 5.25px;
            border-radius: 2.25px;
            margin-top: 4.5px;
            display: none;
            font-weight: 600;
            font-size: 0.525rem;
            border-left: 2.25px solid var(--accent-red);
        }

        .success-box {
            background: #d1fae5;
            color: var(--accent-green);
            padding: 3.75px 5.25px;
            border-radius: 2.25px;
            margin-top: 4.5px;
            display: none;
            font-weight: 600;
            font-size: 0.525rem;
            border-left: 2.25px solid var(--accent-green);
        }

        .notification-box {
            background: #fef3c7;
            color: #d97706;
            padding: 7.5px;
            border-radius: 4.5px;
            margin-top: 7.5px;
            font-weight: 600;
            font-size: 0.525rem;
            text-align: center;
            border-left: 3px solid #f59e0b;
        }

        .quiz-notification {
            position: fixed;
            top: 15px;
            right: 15px;
            background: white;
            padding: 11.25px;
            border-radius: 7.5px;
            box-shadow: var(--shadow-xl);
            z-index: 1000;
            display: none;
            max-width: 225px;
            border-left: 3.75px solid var(--accent-green);
            animation: slideInRight 0.3s ease;
            transform: translateX(100%);
        }

        .quiz-notification.show {
            display: block;
            transform: translateX(0);
        }

        .quiz-notification.warning {
            border-left-color: var(--accent-orange);
        }

        .quiz-notification.error {
            border-left-color: var(--accent-red);
        }

        .quiz-notification-content {
            display: flex;
            flex-direction: column;
            gap: 7.5px;
        }

        .quiz-notification-title {
            font-weight: 700;
            font-size: 0.6rem;
            color: var(--dark-blue);
        }

        .quiz-notification-message {
            font-size: 0.525rem;
            color: #4b5563;
        }

        .quiz-notification-actions {
            display: flex;
            gap: 6px;
            justify-content: flex-end;
        }

        .quiz-notification-btn {
            padding: 3px 6px;
            border-radius: 3px;
            font-size: 0.4875rem;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }

        .quiz-notification-btn.primary {
            background: var(--gradient-blue);
            color: white;
        }

        .quiz-notification-btn.secondary {
            background: #f3f4f6;
            color: #4b5563;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        .main-page-buttons {
            display: grid;
            gap: 6px;
            margin-top: 9px;
        }

        .quiz-access-section {
            display: none;
            flex-direction: column;
            gap: 6px;
            margin-top: 9px;
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 6px;
            padding-bottom: 4.5px;
            border-bottom: 1.5px solid var(--light-blue);
        }

        .quiz-title-container {
            display: flex;
            flex-direction: column;
            gap: 2.25px;
            width: 80%;
        }

        .quiz-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
            font-size: 0.525rem;
            color: var(--dark-blue);
            font-weight: 600;
        }

        .timer-container {
            display: flex;
            gap: 4.5px;
            justify-content: flex-end;
            width: 100%;
        }

        .timer, .question-timer {
            background: var(--gradient-blue);
            color: white;
            padding: 2.25px 4.5px;
            border-radius: 7.5px;
            font-weight: 700;
            font-size: 0.525rem;
            box-shadow: var(--shadow);
            white-space: nowrap;
        }

        .timer.total-timer {
            background: var(--gradient-orange);
        }

        .progress-container {
            width: 100%;
            height: 4.5px;
            background: #e5e7eb;
            border-radius: 2.25px;
            overflow: hidden;
            margin-bottom: 6px;
            box-shadow: var(--shadow);
        }

        .progress-bar {
            height: 100%;
            border-radius: 2.25px;
            transition: width 0.4s ease;
            background: var(--gradient-vibrant);
        }

        .question-nav {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(10.5px, 1fr));
            gap: 2.25px;
            margin-bottom: 6px;
        }

        .question-nav-item {
            width: 10.5px;
            height: 10.5px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 2.25px;
            font-weight: 700;
            font-size: 0.375rem;
            cursor: pointer;
            background: white;
            border: 1.5px solid var(--light-blue);
            transition: all 0.2s;
        }

        .question-nav-item.current {
            background: var(--gradient-vibrant);
            color: white;
            border-color: var(--primary-blue);
            transform: scale(1.1);
        }

        .question-nav-item.solved {
            background: var(--gradient-green);
            color: white;
            border-color: var(--accent-green);
        }

        .question-nav-item.visited {
            background: var(--gradient-orange);
            color: white;
            border-color: var(--accent-orange);
        }

        .question-container {
            margin-bottom: 6px;
        }

        .question-text {
            font-size: 0.5625rem;
            font-weight: 700;
            margin-bottom: 4.5px;
            color: var(--dark-blue);
        }

        .options-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 3px;
            margin-bottom: 6px;
        }

        .option {
            padding: 3.75px 6px;
            border: 1.5px solid var(--light-blue);
            border-radius: 3.75px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            background: #f8fafc;
            font-size: 0.525rem;
            position: relative;
        }

        .option:hover {
            border-color: var(--primary-blue);
            background: #e0f2fe;
            transform: translateY(-1px);
        }

        .option.selected {
            border-color: var(--primary-blue);
            background: #dbeafe;
        }

        .option.correct {
            border-color: var(--accent-green);
            background: #d1fae5;
        }

        .option.incorrect {
            border-color: var(--accent-red);
            background: #fee2e2;
        }

        .option input[type="radio"] {
            position: absolute;
            opacity: 0;
            cursor: pointer;
        }

        .reasoning {
            background: #f8fafc;
            border-radius: 3.75px;
            padding: 6px;
            margin-top: 6px;
            display: none;
            border-left: 2.25px solid var(--primary-blue);
            font-size: 0.525rem;
        }

        .reasoning-title {
            font-weight: 700;
            margin-bottom: 3px;
            color: var(--dark-blue);
            font-size: 0.5625rem;
        }

        .navigation-buttons {
            display: flex;
            flex-direction: column;
            gap: 3px;
            margin-top: 9px;
        }

        .nav-btn {
            padding: 3.75px 5.25px;
            border-radius: 3.75px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
            font-size: 0.525rem;
            display: flex;
            align-items: center;
            gap: 2.25px;
            justify-content: center;
            width: 100%;
        }

        .btn-back {
            background: linear-gradient(135deg, #3b82f6, #60a5fa);
            color: white;
        }

        .btn-next {
            background: linear-gradient(135deg, #1d4ed8, #3b82f6);
            color: white;
        }

        .btn-reasoning {
            background: var(--gradient-purple);
            color: white;
        }

        .btn-reasoning.disabled {
            background: #dc3545;
            color: white;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .btn-reasoning.disabled:hover {
            background: #dc3545;
            transform: none;
            box-shadow: none;
        }

        .btn-submit {
            background: var(--gradient-green);
            color: white;
        }

        .results-header-buttons {
            display: flex;
            flex-direction: column;
            gap: 3.75px;
            margin-bottom: 9px;
        }

        .results-header-buttons .btn {
            padding: 3px 4.5px;
            font-size: 0.4875rem;
            width: 100%;
        }

        .result-card {
            background: linear-gradient(135deg, #f8fafc, #e0f2fe);
            border-radius: 6px;
            padding: 9px;
            text-align: center;
            margin-bottom: 9px;
            box-shadow: var(--shadow);
            position: relative;
            z-index: 1;
            overflow: hidden;
        }

        .result-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-vibrant);
        }

        .result-card h2 {
            font-size: 0.675rem;
            margin-bottom: 6px;
            color: var(--dark-blue);
        }

        .result-card table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.525rem;
            margin-top: 6px;
            box-shadow: var(--shadow);
        }

        .result-card th, .result-card td {
            padding: 3.75px;
            border: 1px solid #dbeafe;
            text-align: left;
        }

        .result-card th {
            background-color: var(--light-blue);
            font-weight: 600;
        }

        .result-card td {
            background-color: #f8fafc;
        }

        .result-actions {
            display: flex;
            flex-direction: column;
            gap: 4.5px;
            margin-top: 9px;
        }

        .all-mcqs-list {
            display: flex;
            flex-direction: column;
            gap: 11.25px;
        }

        .all-mcq-item {
            padding: 7.5px;
            border: 1px solid var(--light-blue);
            border-radius: 6px;
            background: #f8fafc;
            position: relative;
        }

        .all-mcq-item .question-text {
            color: var(--dark-blue);
            font-size: 0.6rem;
            font-weight: 700;
        }

        .all-mcq-options {
            display: flex;
            flex-direction: column;
            gap: 3px;
            margin-top: 4.5px;
        }

        .all-mcq-option {
            font-size: 0.525rem;
            padding: 3px 4.5px;
            border-radius: 3px;
            border: 1px solid #e5e7eb;
        }

        .all-mcq-option.correct {
            background: #d1fae5;
            color: var(--accent-green);
            font-weight: 600;
            border-color: #a7f3d0;
        }

        .all-mcq-reasoning {
            margin-top: 6px;
            font-size: 0.525rem;
            color: #4b5563;
            padding: 6px;
            background: #f8fafc;
            border-radius: 3px;
            border-left: 2.25px solid var(--primary-blue);
        }

        .all-mcq-reasoning strong {
            color: var(--dark-blue);
        }

        .quick-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 9px;
            gap: 6px;
        }

        .stat-card {
            flex: 1;
            background: white;
            border-radius: 4.5px;
            padding: 6px;
            text-align: center;
            box-shadow: var(--shadow);
            border-top: 2px solid var(--primary-blue);
        }

        .stat-card.correct {
            border-top-color: var(--accent-green);
        }

        .stat-card.incorrect {
            border-top-color: var(--accent-red);
        }

        .stat-card.unanswered {
            border-top-color: var(--accent-orange);
        }

        .stat-value {
            font-size: 0.9rem;
            font-weight: 800;
            margin-bottom: 1.5px;
        }

        .stat-label {
            font-size: 0.4875rem;
            font-weight: 600;
            color: #6b7280;
        }

        .performance-meter {
            width: 100%;
            height: 6px;
            background: #e5e7eb;
            border-radius: 3px;
            overflow: hidden;
            margin: 6px 0;
        }

        .performance-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.4s ease;
            background: var(--gradient-vibrant);
        }

        @media (max-width: 768px) {
            .quiz-header {
                flex-direction: column;
                gap: 4.5px;
                align-items: flex-start;
            }
            
            .navigation-buttons {
                grid-template-columns: 1fr;
            }
            
            .timer-container {
                position: relative;
                top: auto;
                right: auto;
                margin-top: 3.75px;
                justify-content: flex-end;
                width: 100%;
            }
            
            .quiz-title-container {
                width: 100%;
            }
            
            .result-actions {
                flex-direction: column;
            }
            
            .promo-banner {
                padding: 9px;
            }
            
            .promo-banner h2 {
                font-size: 0.6rem;
            }
            
            .promo-banner p {
                font-size: 0.4125rem;
            }
        }
    </style>
</head>
<body>
    <div class="quiz-notification" id="quiz-notification">
        <div class="quiz-notification-content">
            <div class="quiz-notification-title" id="notification-title">Quiz Progress Found</div>
            <div class="quiz-notification-message" id="notification-message">You have an unfinished quiz. Do you want to continue where you left off?</div>
            <div class="quiz-notification-actions">
                <button class="quiz-notification-btn secondary" id="notification-no">Start Fresh</button>
                <button class="quiz-notification-btn primary" id="notification-yes">Continue</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="logo">
            <h1>WHITE COAT WARRIORS</h1>
            <p>Excellence in Educational Assessment</p>
        </div>

        <div id="signin-page" class="page active">
            <div class="promo-banner">
                <h2><i class="fas fa-graduation-cap"></i> Unlock Your Potential with WHITE COAT WARRIORS</h2>
                <p>Boost your preparation with WHITE COAT WARRIORS's realistic online tests, crafted by experts to mirror the actual exam's pattern and challenge. Experience instant feedback, detailed analysis, and flexible online access – your pathway to confidence and success!</p>
            </div>
            
            <h2><i class="fas fa-lock"></i> Access Test</h2>
            <p>Sign in or use your access code</p>
            
            <div class="main-page-buttons">
                <button class="btn btn-primary" onclick="showQuizAccessForm()">
                    <i class="fas fa-key"></i>
                    <span>Sign In with Quiz Access Code</span>
                </button>
                <button class="btn btn-primary" onclick="showRegistrationPage()">
                    <i class="fas fa-user-plus"></i>
                    <span>Sign Up to Get Quiz Access</span>
                </button>
                <button class="btn btn-purple" onclick="showDeveloperAccessForm()">
                    <i class="fas fa-code"></i>
                    <span>Developer Access</span>
                </button>
            </div>
            
            <div id="developer-access-form" class="quiz-access-section">
                <h3><i class="fas fa-user-secret"></i> Developer Login</h3>
                <div class="password-container input-container">
                    <input type="password" id="developerPassword" class="form-input" placeholder="Enter the Developer Password">
                    <i class="fas fa-eye-slash input-icon" id="toggleDeveloperPassword"></i>
                </div>
                <button class="btn btn-purple" onclick="checkDeveloperPassword()">
                    <span>Log In</span>
                    <i class="fas fa-arrow-right"></i>
                </button>
                <div id="dev-error-box" class="error-box">
                    <i class="fas fa-exclamation-circle"></i> Invalid developer password.
                </div>
            </div>
            
            <div id="quiz-access-form" class="quiz-access-section">
                <h3><i class="fas fa-key"></i> Enter Quiz Access Code</h3>
                <div class="password-container input-container">
                    <input type="password" id="quizAccessCode" class="form-input" placeholder="Enter your 12-Digit Quiz Access Code here">
                    <i class="fas fa-eye-slash input-icon" id="toggleQuizAccessCode"></i>
                </div>
                <button class="btn btn-primary" onclick="accessQuiz(document.getElementById('quizAccessCode').value)">
                    <span>Access Quiz</span>
                    <i class="fas fa-arrow-right"></i>
                </button>
                <div id="quiz-error-box" class="error-box">
                    <i class="fas fa-exclamation-circle"></i> Invalid quiz access code.
                </div>
            </div>
            
        </div>

        <div id="registration-page" class="page">
            <div class="promo-banner">
                <h2><i class="fas fa-graduation-cap"></i> Unlock Your Potential with WHITE COAT WARRIORS</h2>
                <p>Boost your preparation with WHITE COAT WARRIORS's realistic online tests, crafted by experts to mirror the actual exam's pattern and challenge. Experience instant feedback, detailed analysis, and flexible online access – your pathway to confidence and success!</p>
            </div>
            
            <h2><i class="fas fa-user-edit"></i> Student Registration</h2>
            <p>Please provide your details to register</p>
            
            <div class="form-group">
                <label class="form-label"><i class="fas fa-user"></i> Student Name</label>
                <input type="text" id="studentName" class="form-input" placeholder="Enter your full name">
            </div>
            <div class="form-group">
                <label class="form-label"><i class="fas fa-user-friends"></i> Father Name</label>
                <input type="text" id="fatherName" class="form-input" placeholder="Enter your father's name">
            </div>
            <div class="form-group">
                <label class="form-label"><i class="fas fa-envelope"></i> Email Address</label>
                <input type="email" id="email" class="form-input" placeholder="Enter your email address">
            </div>
            <div class="form-group">
                <label class="form-label"><i class="fas fa-phone"></i> Mobile Number (WhatsApp)</label>
                <input type="tel" id="mobile" class="form-input" placeholder="+92XXXXXXXXXX">
            </div>
            <div class="form-group">
                <label class="form-label"><i class="fas fa-city"></i> City / District</label>
                <input type="text" id="city" class="form-input" placeholder="Enter your city/district">
            </div>
            <button class="btn btn-primary" onclick="handleRegistration()">
                <span>Submit to Get Access to Quiz</span>
                <i class="fas fa-arrow-right"></i>
            </button>
            <button class="btn btn-red" style="margin-top: 3.75px;" onclick="showPage('signin-page')">
                <i class="fas fa-chevron-left"></i> Back to Home
            </button>
        </div>

        <div id="quiz-page" class="page">
            <div class="promo-banner">
                <h2><i class="fas fa-graduation-cap"></i> Unlock Your Potential with WHITE COAT WARRIORS</h2>
                <p>Boost your preparation with WHITE COAT WARRIORS's realistic online tests, crafted by experts to mirror the actual exam's pattern and challenge. Experience instant feedback, detailed analysis, and flexible online access – your pathway to confidence and success!</p>
            </div>

            <div class="quiz-header">
                <div class="quiz-title-container">
                    <h2 id="quiz-title"></h2>
                    <div class="quiz-info">
                        <span><i class="fas fa-book"></i> Subject: <span id="quiz-subject">English Grammar</span></span>
                        <span><i class="fas fa-clock"></i> Per MCQ: <span id="per-mcq-time">1</span> Minute</span>
                    </div>
                </div>
            </div>
            <div class="timer-container">
                <div class="timer" id="question-timer">60</div>
                <div class="timer total-timer" id="timer">40:00</div>
            </div>

            <div class="progress-container">
                <div class="progress-bar" id="quiz-progress"></div>
            </div>

            <div class="question-nav" id="question-nav"></div>
            
            <div class="question-container">
                <div class="question-text" id="question-text"></div>
                <div class="options-container" id="options-container"></div>
                <div class="reasoning" id="reasoning">
                    <div class="reasoning-title"><i class="fas fa-lightbulb"></i> Explanation:</div>
                    <div id="reasoning-text"></div>
                </div>
            </div>
            
            <div class="navigation-buttons">
                <button class="nav-btn btn-back" onclick="navigateQuestion('prev')">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <button class="nav-btn btn-next" onclick="navigateQuestion('next')">
                    Next <i class="fas fa-arrow-right"></i>
                </button>
                <button class="nav-btn btn-reasoning disabled" id="reasoning-btn" onclick="toggleReasoning()">
                    <i class="fas fa-lightbulb"></i> Reasoning
                </button>
                <button class="nav-btn btn-submit" onclick="submitTest()">
                    Submit <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>

        <div id="results-page" class="page">
            <div class="results-header-buttons">
                <a id="website-link" href="#" target="_blank" class="btn btn-primary"><i class="fas fa-globe"></i> Website</a>
                <a id="whatsapp-contact-link" href="#" target="_blank" class="btn btn-whatsapp"><i class="fab fa-whatsapp"></i> Whatsapp Contact</a>
                <a id="whatsapp-community-link" href="#" target="_blank" class="btn btn-whatsapp"><i class="fas fa-users"></i> Whatsapp Community</a>
            </div>
            
            <div class="quick-stats">
                <div class="stat-card correct">
                    <div class="stat-value" id="correct-count">0</div>
                    <div class="stat-label">Correct</div>
                </div>
                <div class="stat-card incorrect">
                    <div class="stat-value" id="incorrect-count">0</div>
                    <div class="stat-label">Incorrect</div>
                </div>
                <div class="stat-card unanswered">
                    <div class="stat-value" id="unanswered-count">0</div>
                    <div class="stat-label">Unanswered</div>
                </div>
            </div>
            
            <div class="performance-meter">
                <div class="performance-fill" id="performance-fill"></div>
            </div>
            
            <div class="result-card">
                <h2><i class="fas fa-user-graduate"></i> Student Information</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Field</th>
                            <th>Detail</th>
                        </tr>
                    </thead>
                    <tbody id="student-info-table"></tbody>
                </table>
            </div>

            <div class="result-card">
                <h2><i class="fas fa-chart-bar"></i> Test Results</h2>
                <table>
                    <tbody id="quiz-results-table"></tbody>
                </table>
            </div>
            
            <div class="result-actions">
                <button class="btn btn-primary" onclick="restartTest()">
                    <i class="fas fa-redo"></i> Retake Full Test
                </button>
                <button class="btn btn-primary" onclick="retakeIncorrect()">
                    <i class="fas fa-bolt"></i> Retake Incorrect Questions
                </button>
                <button class="btn btn-primary" onclick="viewAllMcqs()">
                    <i class="fas fa-clipboard-list"></i> View All MCQs
                </button>
            </div>
        </div>

        <div id="all-mcqs-page" class="page">
            <h2><i class="fas fa-list-alt"></i> All MCQs and Solutions</h2>
            <div class="all-mcqs-list" id="all-mcqs-list"></div>
            <button class="btn btn-primary" onclick="showPage('results-page')">
                <i class="fas fa-arrow-left"></i> Back to Results
            </button>
        </div>
    </div>
    
    <script src="script.js"></script>
</body>
</html><script>// ***************************************************************
// !! IMPORTANT: GOOGLE APPS SCRIPT URL FOR DATA LOGGING !!
const SHEET_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxH08_vQhw7nqJCy3igwm70zXI2Mwau8CvcIeXdZMF2dFm9bPfgWtP6En4GQZGKte7c/exec';
// ***************************************************************

// Quiz Data
const quizData_WCW_BIO_01 = [
    {
        question: "What is the primary characteristic of cellular respiration regarding energy and molecular complexity?",
        options: [
            "It synthesizes complex organic compounds from simpler molecules, consuming energy.",
            "It breaks down complex organic compounds into simpler molecules, releasing energy.",
            "It involves gas exchange between the body fluids and the external environment.",
            "It occurs exclusively in the presence of sunlight, producing oxygen."
        ],
        correctAnswer: 1,
        reasoning: "The Book theory State that: Cellular/Internal Respiration is a catabolic process within cells where complex organic compounds break down into simpler molecules, releasing energy."
    },
    {
        question: "Which property is crucial for the efficient diffusion of gases across a respiratory surface?",
        options: [
            "Thickness exceeding 1 millimeter.",
            "A dry and impermeable barrier.",
            "A small surface area to minimize energy expenditure.",
            "A thin barrier, typically 1 mm or less."
        ],
        correctAnswer: 3,
        reasoning: "The Book theory State that: For effective gas diffusion, the respiratory surface must be Thin, as diffusion is efficient only over short distances (1 mm or less)."
    },
    {
        question: "The nasal cavities are primarily lined with which type of tissue to perform defense mechanisms?",
        options: [
            "Smooth muscle tissue without cilia.",
            "Stratified squamous epithelium.",
            "Mucous membranes and cilia.",
            "Dense connective tissue for structural support."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: Nasal Cavities are inner hollow spaces, partitioned by the nasal septum, lined with mucous membranes and cilia. These structures, along with nose hairs, mucus, and cilia, filter out pathogens, dust, and particulate matter."
    },
    {
        question: "What is the specific function of the epiglottis during the act of swallowing?",
        options: [
            "To vibrate and produce vocal sounds.",
            "To connect the nasal and oral cavities to the esophagus.",
            "To prevent food and liquids from entering the air passages.",
            "To reinforce the trachea and prevent its collapse."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: The Epiglottis prevents food and liquids from entering the air passages during swallowing."
    },
    {
        question: "What reinforces the trachea, preventing its collapse while allowing flexibility?",
        options: [
            "Dense fibrous tissue forming a solid tube.",
            "A continuous ring of hyaline cartilage.",
            "15-20 C-shaped cartilage pieces, open posteriorly.",
            "Elastic tissue without any cartilaginous support."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: The Trachea is a membranous tube (approx. 10-12 cm long) reinforced with 15-20 C-shaped cartilage pieces (open posteriorly) to prevent collapse."
    },
    {
        question: "Which structures lack cartilage and are responsible for controlling air distribution by changing their diameter?",
        options: [
            "Primary bronchi.",
            "Trachea.",
            "Bronchioles.",
            "Alveolar ducts."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: Bronchioles (less than 1mm diameter) lack cartilage. Bronchioles control air distribution by changing diameter."
    },
    {
        question: "What is the primary function of surfactant within the alveoli?",
        options: [
            "To increase the surface area for gas exchange.",
            "To produce vocal sounds through vibration.",
            "To lower surface tension and prevent alveolar collapse.",
            "To transport oxygen directly to the blood capillaries."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: Surfactant is a lipoprotein secreted by alveolar cells that lowers surface tension, prevents alveolar collapse, aids gas transport, and kills bacteria."
    },
    {
        question: "Which muscle is a large, dome-shaped skeletal muscle separating the thoracic and abdominal cavities, crucial for breathing?",
        options: [
            "External intercostal muscle.",
            "Internal intercostal muscle.",
            "Diaphragm.",
            "Abdominal rectus muscle."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: The Diaphragm is a large, dome-shaped skeletal muscle separating the thoracic and abdominal cavities, responsible for breathing."
    },
    {
        question: "During normal inspiration, what action do the external intercostal muscles perform?",
        options: [
            "They relax, moving the rib cage downward and inward.",
            "They contract, moving the rib cage upward and forward.",
            "They contract, moving the rib cage downward and backward.",
            "They relax, allowing the rib cage to remain stationary."
        ],
        correctAnswer: 1,
        reasoning: "The Book theory State that: During Inspiration, external intercostal muscles contract, moving the rib cage upward and forward."
    },
    {
        question: "What is the approximate volume of air exchanged during normal, quiet breathing?",
        options: [
            "3000 ml.",
            "1200 ml.",
            "500 ml.",
            "1.5 liters."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: Tidal Volume (TV) is the volume of air exchanged during normal, quiet breathing (approx. 500 ml)."
    },
    {
        question: "Which part of the brain is the primary control center for involuntary breathing?",
        options: [
            "Cerebral hemispheres.",
            "Pons.",
            "Cerebellum.",
            "Medulla oblongata."
        ],
        correctAnswer: 3,
        reasoning: "The Book theory State that: Breathing is largely an involuntary process, controlled by a breathing center in the medulla oblongata of the brain."
    },
    {
        question: "How is the majority of oxygen transported in the blood?",
        options: [
            "As dissolved oxygen in plasma.",
            "By red blood cells as oxyhaemoglobin.",
            "Bound to plasma proteins.",
            "As bicarbonate ions."
        ],
        correctAnswer: 1,
        reasoning: "The Book theory State that: 97% of oxygen is carried by red blood cells as oxyhaemoglobin (HbO2), where haemoglobin binds with 4 oxygen molecules."
    },
    {
        question: "In the context of gas transport, what is the role of carbonic anhydrase?",
        options: [
            "To bind oxygen to haemoglobin.",
            "To catalyze the formation of carbonic acid from CO2 and water.",
            "To transport carbon dioxide as carbaminohaemoglobin.",
            "To facilitate the release of oxygen from haemoglobin in tissues."
        ],
        correctAnswer: 1,
        reasoning: "The Book theory State that: CO2 diffuses into RBCs and reacts with water to form carbonic acid (H2CO3) in the presence of carbonic anhydrase."
    },
    {
        question: "Which respiratory pigment is found in skeletal muscles and acts as an oxygen store?",
        options: [
            "Haemoglobin.",
            "Chlorophyll.",
            "Myoglobin.",
            "Cytochrome."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: Myoglobin is found in skeletal muscles and acts as an oxygen store in muscles."
    },
    {
        question: "Carbon monoxide poisoning is dangerous because CO binds to haemoglobin how many times more readily than oxygen?",
        options: [
            "Approximately 20 times.",
            "Approximately 50 times.",
            "Approximately 100 times.",
            "Approximately 249 times."
        ],
        correctAnswer: 3,
        reasoning: "The Book theory State that: Carbon Monoxide (CO) binds to haemoglobin 249 times more readily than oxygen, preventing oxygen transport and leading to tissue hypoxia."
    },
    {
        question: "What is the function of the uvula during swallowing?",
        options: [
            "To produce vocal sounds.",
            "To filter incoming air.",
            "To close the nasopharynx.",
            "To prevent food from entering the trachea."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: The Uvula is a conic projection that closes the nasopharynx during swallowing and produces saliva."
    },
    {
        question: "Which part of the pharynx has a primary respiratory function?",
        options: [
            "Oropharynx.",
            "Laryngopharynx.",
            "Nasopharynx.",
            "Esopharynx."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: The Pharynx is divided into: Nasopharynx (respiratory function), Oropharynx (swallowing), and Laryngopharynx (where respiratory and digestive tracts diverge)."
    },
    {
        question: "What type of tissue lines the alveolar walls, enabling efficient gas exchange?",
        options: [
            "Ciliated columnar epithelium.",
            "Cuboidal epithelium.",
            "Stratified squamous epithelium.",
            "Moist squamous epithelium."
        ],
        correctAnswer: 3,
        reasoning: "The Book theory State that: Alveolar walls are extremely thin (0.1 µm), lined with moist squamous epithelium, and surrounded by a dense network of blood capillaries."
    },
    {
        question: "What happens to the diaphragm during normal expiration?",
        options: [
            "It contracts and moves downward.",
            "It relaxes and returns to its dome shape.",
            "It remains contracted and stationary.",
            "It contracts and moves upward."
        ],
        correctAnswer: 1,
        reasoning: "The Book theory State that: During Expiration (normally passive), the diaphragm relaxes and returns to its dome shape (moves upward)."
    },
    {
        question: "Which respiratory volume represents the air remaining in the lungs after a forcible expiration?",
        options: [
            "Tidal Volume.",
            "Inspiratory Reserve Volume.",
            "Expiratory Reserve Volume.",
            "Residual Volume."
        ],
        correctAnswer: 3,
        reasoning: "The Book theory State that: Residual Volume (RV) is the volume of air remaining in the lungs even after a forcible expiration (approx. 1.5 liters)."
    },
    {
        question: "The respiratory system is responsible for the exchange of gases between body fluids and the external environment. This statement describes which level of respiration?",
        options: [
            "Cellular respiration.",
            "Internal respiration.",
            "Organismic/External respiration.",
            "Anaerobic respiration."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: Organismic/External Respiration is the process of inhaling oxygen from the environment and exhaling carbon dioxide into it. The respiratory system is responsible for the exchange of gases between body fluids and the external environment."
    },
    {
        question: "For effective gas diffusion, the respiratory surface must possess what characteristic to allow gases to pass through easily?",
        options: [
            "Be highly vascularized.",
            "Be moist and permeable.",
            "Be rigid and unyielding.",
            "Be thick to prevent damage."
        ],
        correctAnswer: 1,
        reasoning: "The Book theory State that: For effective gas diffusion, the respiratory surface must be Moist and Permeable to allow gases to pass through easily."
    },
    {
        question: "The nose includes vestibules, which are the anterior parts near the nostrils. These vestibules contain what structures?",
        options: [
            "Vocal cords.",
            "Olfactory bulbs.",
            "Hairs.",
            "Turbinates."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: Vestibules are anterior parts near nostrils containing hairs."
    },
    {
        question: "The pharynx is described as a cone-shaped passageway. What does it connect?",
        options: [
            "The trachea to the bronchi.",
            "The larynx to the alveoli.",
            "Nasal and oral cavities to the esophagus and larynx.",
            "The bronchioles to the alveolar ducts."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: The Pharynx (Throat) is a cone-shaped passageway connecting nasal and oral cavities to the esophagus and larynx."
    },
    {
        question: "The larynx is an enlargement at the top of the trachea. What is its common name?",
        options: [
            "Windpipe.",
            "Throat.",
            "Voice Box/Glottis.",
            "Bronchial tree."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: The Larynx is an enlargement at the top of the trachea, commonly known as the Voice Box/Glottis."
    },
    {
        question: "The trachea divides into two primary bronchi. How does the right bronchus compare to the left?",
        options: [
            "It is narrower and longer.",
            "It is wider and shorter.",
            "It is structurally identical to the left.",
            "It leads directly to the left lung."
        ],
        correctAnswer: 1,
        reasoning: "The Book theory State that: The trachea divides into two primary bronchi (right bronchus is wider and shorter than the left)."
    },
    {
        question: "Alveoli are described as tiny air-filled chambers. What is their primary role?",
        options: [
            "To warm and moisten incoming air.",
            "To produce vocal sounds.",
            "To filter particulate matter from the air.",
            "To serve as primary sites of gas exchange between air and blood."
        ],
        correctAnswer: 3,
        reasoning: "The Book theory State that: Alveoli are tiny air-filled chambers that are the primary sites of gas exchange between air and blood."
    },
    {
        question: "The lungs are the principal organs of respiration, conical in shape. Where does their base rest?",
        options: [
            "On the clavicle.",
            "On the heart.",
            "On the diaphragm.",
            "On the sternum."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: Lungs are the principal organs of respiration, conical in shape, with the base resting on the diaphragm."
    },
    {
        question: "Breathing is accomplished by the diaphragm, abdominal muscles, and intercostal muscles. What is true regarding the lungs' role in this process?",
        options: [
            "Lungs actively draw in and push out air.",
            "Lungs themselves do not actively draw in or push out air.",
            "Lungs contract during inspiration and relax during expiration.",
            "Lungs are the only muscles involved in quiet breathing."
        ],
        correctAnswer: 1,
        reasoning: "The Book theory State that: Breathing is accomplished by the diaphragm, abdominal muscles, and intercostal muscles, as the lungs themselves do not actively draw in or push out air."
    },
    {
        question: "During inspiration, the volume of the thoracic cavity changes. What is the effect on pressure in the lungs?",
        options: [
            "Volume decreases, increasing pressure above atmospheric pressure.",
            "Volume increases, reducing pressure to below atmospheric pressure.",
            "Volume increases, increasing pressure above atmospheric pressure.",
            "Volume decreases, reducing pressure to below atmospheric pressure."
        ],
        correctAnswer: 1,
        reasoning: "The Book theory State that: During Inspiration, the volume of the thoracic cavity increases, reducing pressure in the lungs to below atmospheric pressure, causing air to rush in."
    },
    {
        question: "In forced exhalation, what action do the internal intercostal muscles perform?",
        options: [
            "They relax.",
            "They contract.",
            "They move the rib cage upward.",
            "They remain inactive."
        ],
        correctAnswer: 1,
        reasoning: "The Book theory State that: During Expiration (especially in forced exhalation), internal intercostal muscles contract."
    },
    {
        question: "What is the approximate average adult lung capacity?",
        options: [
            "About 2 liters.",
            "About 3 liters.",
            "About 4 liters.",
            "About 5 liters."
        ],
        correctAnswer: 3,
        reasoning: "The Book theory State that: Average adult lung capacity is about 5 liters."
    },
    {
        question: "Inspiratory Reserve Volume (IRV) is defined as what?",
        options: [
            "Volume of air exchanged during normal breathing.",
            "Additional air that can be forcibly inhaled after a normal tidal inspiration.",
            "Additional air that can be forcibly exhaled after a normal tidal expiration.",
            "Volume of air remaining in the lungs after forcible expiration."
        ],
        correctAnswer: 1,
        reasoning: "The Book theory State that: Inspiratory Reserve Volume (IRV) is the additional air that can be forcibly inhaled after a normal tidal inspiration (approx. 3000 ml)."
    },
    {
        question: "Nerve impulses for breathing are sent to the diaphragm via which specific nerves?",
        options: [
            "Intercostal nerves.",
            "Vagus nerves.",
            "Phrenic nerves.",
            "Spinal accessory nerves."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: Nerve impulses are sent via intercostal nerves to intercostal muscles and phrenic nerves to the diaphragm."
    },
    {
        question: "How much oxygen is transported as dissolved oxygen in plasma?",
        options: [
            "97%.",
            "70%.",
            "23%.",
            "3%."
        ],
        correctAnswer: 3,
        reasoning: "The Book theory State that: 3% of oxygen is transported as dissolved oxygen in plasma."
    },
    {
        question: "The Oxygen-Haemoglobin Dissociation Curve illustrates what relationship with partial pressure of oxygen (PO2)?",
        options: [
            "Higher PO2 in tissues leads to more oxygen binding to haemoglobin.",
            "Lower PO2 in lungs leads to oxygen dissociation from haemoglobin.",
            "Higher PO2 in lungs leads to more oxygen binding to haemoglobin.",
            "PO2 has no effect on oxygen binding to haemoglobin."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: The Oxygen-Haemoglobin Dissociation Curve illustrates that higher PO2 (e.g., in lungs) leads to more oxygen binding to haemoglobin, while lower PO2 (e.g., in tissues) leads to oxygen dissociation and release."
    },
    {
        question: "What percentage of carbon dioxide is transported as bicarbonate ions (HCO3-)?",
        options: [
            "Approximately 7%.",
            "Approximately 23%.",
            "Approximately 70%.",
            "Approximately 97%."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: ~70% of CO2 is transported as Bicarbonate Ions (HCO3-)."
    },
    {
        question: "Haemoglobin consists of four polypeptide chains. What are these chains called?",
        options: [
            "Actin.",
            "Myosin.",
            "Globin.",
            "Albumin."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: Haemoglobin consists of four polypeptide chains (globin) and four iron-containing haem groups."
    },
    {
        question: "What is the definition of hiccups?",
        options: [
            "A forceful reflex expiration through the nasal cavity.",
            "Spasmodic contractions of the diaphragm with a closed glottis.",
            "A rough noise during inhalation caused by soft palate vibration.",
            "An involuntary cessation of breathing for short periods."
        ],
        correctAnswer: 1,
        reasoning: "The Book theory State that: Hiccups are spasmodic contractions of the diaphragm with a closed glottis."
    },
    {
        question: "What is snorkeling?",
        options: [
            "A forceful reflex expiration.",
            "Spasmodic contractions of the diaphragm.",
            "A rough noise during inhalation.",
            "An underwater breathing technique using compressed air."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: Snoring is a rough noise during inhalation, typically caused by vibration of the soft palate."
    },
    {
        question: "What is the term for the catabolic process within cells where complex organic compounds break down into simpler molecules, releasing energy?",
        options: [
            "External Respiration.",
            "Ventilation.",
            "Cellular Respiration.",
            "Gas Exchange."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: Cellular/Internal Respiration is a catabolic process within cells where complex organic compounds break down into simpler molecules, releasing energy."
    },
    {
        question: "Which characteristic of the respiratory surface ensures that sufficient gas exchange occurs according to the organism's needs?",
        options: [
            "Moistness.",
            "Thinness.",
            "Large surface area.",
            "Good blood supply."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: For effective gas diffusion, the respiratory surface must have a Large Surface Area to enable sufficient gas exchange according to the organism's needs."
    },
    {
        question: "The nasal septum divides which structures in the upper respiratory tract?",
        options: [
            "Nostrils.",
            "Nasal cavities.",
            "Pharynx.",
            "Larynx."
        ],
        correctAnswer: 1,
        reasoning: "The Book theory State that: Nasal Cavities are inner hollow spaces, partitioned by the nasal septum."
    },
    {
        question: "The glottis is primarily defined as what?",
        options: [
            "The opening of the larynx.",
            "The structure preventing food from entering the trachea.",
            "The cartilaginous reinforcement of the trachea.",
            "The membrane lining the nasal cavity."
        ],
        correctAnswer: 0,
        reasoning: "The Book theory State that: Glottis is the opening of the larynx."
    },
    {
        question: "How many lobes does the right lung typically have?",
        options: [
            "One.",
            "Two.",
            "Three.",
            "Four."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: The right lung has three lobes."
    },
    {
        question: "Which phase of breathing is normally considered passive?",
        options: [
            "Inspiration.",
            "Inhalation.",
            "Expiration.",
            "Both inspiration and expiration."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: Expiration (Exhalation) is normally a Passive Phase."
    },
    {
        question: "After a normal tidal expiration, what is the additional air that can be forcibly exhaled called?",
        options: [
            "Tidal Volume.",
            "Inspiratory Reserve Volume.",
            "Expiratory Reserve Volume.",
            "Residual Volume."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: Expiratory Reserve Volume (ERV) is the additional air that can be forcibly exhaled after a normal tidal expiration."
    },
    {
        question: "Which center in the medulla oblongata is responsible for increasing the rate and depth of inspiration?",
        options: [
            "Expiratory Center.",
            "Voluntary Control Center.",
            "Inspiratory Center.",
            "Pons Reflex Center."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: The Inspiratory Center in the medulla oblongata increases the rate and depth of inspiration."
    },
    {
        question: "What is the effect of haemoglobin buffering H+ ions during CO2 transport?",
        options: [
            "It prevents CO2 from reacting with water.",
            "It promotes oxygen binding to haemoglobin.",
            "It prevents a significant drop in blood pH.",
            "It facilitates the chloride shift into the plasma."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: Haemoglobin buffers the H+ ions, preventing significant pH drop, which is crucial during the transport of carbon dioxide as bicarbonate ions."
    },
    {
        question: "Compared to myoglobin, haemoglobin has what characteristic regarding oxygen affinity?",
        options: [
            "Higher affinity for oxygen.",
            "Lower affinity for oxygen.",
            "Equal affinity for oxygen.",
            "Affinity that is independent of PO2."
        ],
        correctAnswer: 1,
        reasoning: "The Book theory State that: Haemoglobin loses oxygen at a higher PO2 (e.g., 60 mmHg) compared to myoglobin. Less affinity for oxygen."
    },
    {
        question: "What is a major cause of cancers in the mouth, larynx, and esophagus, in addition to lung cancer?",
        options: [
            "Environmental allergens.",
            "Viral infections.",
            "Smoking.",
            "Genetic predisposition alone."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: Smoking is a major cause of cancers in the mouth, larynx, and esophagus."
    },
    {
        question: "CPR is described as mouth-to-mouth artificial respiration. What is its purpose?",
        options: [
            "To measure respiratory volumes.",
            "To diagnose respiratory disorders.",
            "To revive individuals who have stopped breathing.",
            "To analyze blood gas levels."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: CPR (Cardiopulmonary Resuscitation) is mouth-to-mouth artificial respiration to revive individuals who have stopped breathing."
    },
    {
        question: "What is an indicator symptom of carbon monoxide poisoning?",
        options: [
            "Bluish discoloration of lips.",
            "Fever and chills.",
            "Cherry-red lips.",
            "Pale skin and rapid breathing."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: Symptoms of Carbon Monoxide poisoning include nausea, headache, and 'cherry-red' lips."
    },
    {
        question: "In what specific part of the lungs does the hilum represent an entry/exit point?",
        options: [
            "Alveoli.",
            "Bronchioles.",
            "The base of the lung.",
            "A triangular depression on the lung surface."
        ],
        correctAnswer: 3,
        reasoning: "The Book theory State that: Hilum is a triangular depression where blood vessels and airways enter/exit the lungs."
    },
    {
        question: "What is the approximate total surface area provided by the human alveoli for gas exchange?",
        options: [
            "5-10 m².",
            "20-30 m².",
            "40-50 m².",
            "70-90 m²."
        ],
        correctAnswer: 3,
        reasoning: "The Book theory State that: Alveoli (over 700 million) provide 70-90 m² surface area, which are the primary sites of gas exchange."
    },
    {
        question: "What mechanism helps maintain a steep diffusion gradient across the respiratory surface?",
        options: [
            "Good blood supply.",
            "Moisture of the surface.",
            "Good ventilation mechanism.",
            "Permeability of the surface."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: A Good Ventilation Mechanism is required to maintain a steep diffusion gradient across the respiratory surface."
    },
    {
        question: "Which structure, part of both the digestive and respiratory systems, is important for vocalization?",
        options: [
            "Nasal cavity.",
            "Trachea.",
            "Pharynx.",
            "Esophagus."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: The Pharynx is part of both digestive and respiratory systems and important for vocalization."
    },
    {
        question: "The trachea's ciliated mucus membrane serves what dual purpose in air passage?",
        options: [
            "Gas exchange and vocalization.",
            "Moistening/warming and protection from foreign particles.",
            "Filtering dust and regulating blood pressure.",
            "Structural support and preventing collapse."
        ],
        correctAnswer: 1,
        reasoning: "The Book theory State that: The Trachea is lined with ciliated mucus membrane for air passage, moistening, warming, and protection from foreign particles."
    },
    {
        question: "What substance secreted by alveolar cells prevents their collapse by lowering surface tension?",
        options: [
            "Mucus.",
            "Elastin.",
            "Surfactant.",
            "Collagen."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: Surfactant, a lipoprotein secreted by alveolar cells, lowers surface tension and prevents alveolar collapse."
    },
    {
        question: "During inspiration, the diaphragm contracts and flattens. What is the immediate consequence for the thoracic cavity volume?",
        options: [
            "It remains unchanged.",
            "It decreases.",
            "It increases.",
            "It fluctuates rapidly."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: During Inspiration, the Diaphragm contracts and flattens (moves downward), which increases the volume of the thoracic cavity."
    },
    {
        question: "Which of the following would lead to an increase in lung pressure above atmospheric pressure, forcing air out?",
        options: [
            "Contraction of the diaphragm.",
            "Relaxation of external intercostal muscles.",
            "Increase in thoracic cavity volume.",
            "Contraction of external intercostal muscles."
        ],
        correctAnswer: 1,
        reasoning: "The Book theory State that: During expiration, external intercostal muscles relax, decreasing the volume of the thoracic cavity, increasing pressure in the lungs to above atmospheric pressure, forcing air out."
    },
    {
        question: "Voluntary control over breathing, such as for speech or singing, originates from which part of the brain?",
        options: [
            "Medulla oblongata.",
            "Pons.",
            "Cerebral hemispheres.",
            "Cerebellum."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: Voluntary Control over breathing is possible within limits, originating from the cerebral hemispheres, used for forced breathing, speech, singing, sneezing, and coughing."
    },
    {
        question: "In the transport of carbon dioxide, what process involves chloride ions moving into RBCs to maintain electrical balance after HCO3- diffuses into the plasma?",
        options: [
            "Oxygen-Haemoglobin Dissociation.",
            "Chloride Shift (Hamburger's phenomenon).",
            "Bohr Effect.",
            "Haldane Effect."
        ],
        correctAnswer: 1,
        reasoning: "The Book theory State that: HCO3- diffuses into the plasma, and Chloride Shift (Hamburger's phenomenon) occurs where chloride ions (Cl-) move into RBCs to maintain electrical balance."
    },
    {
        question: "Which respiratory pigment has a higher affinity for oxygen and releases it when PO2 is very low (below 20 mmHg)?",
        options: [
            "Haemoglobin.",
            "Carbaminohaemoglobin.",
            "Oxyhaemoglobin.",
            "Myoglobin."
        ],
        correctAnswer: 3,
        reasoning: "The Book theory State that: Myoglobin has higher affinity for oxygen and acts as an oxygen store in muscles, releasing oxygen when PO2 is very low (below 20 mmHg)."
    },
    {
        question: "Why do chemicals in cigarette smoke lead to a 'smoker's cough'?",
        options: [
            "They cause permanent damage to alveoli.",
            "They damage cilia, preventing mucus clearance.",
            "They irritate air passages and lungs.",
            "They increase the oxygen-carrying capacity of blood."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: Chemicals in smoke irritate air passages and lungs, causing 'smoker's cough'."
    },
    {
        question: "Birds are noted for their highly efficient respiratory systems. What is a key characteristic contributing to this efficiency?",
        options: [
            "Haemoglobin with low oxygen affinity.",
            "The presence of residual volume in their lungs.",
            "One-way air flow with large air sacs.",
            "A respiratory center insensitive to CO2 levels."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: Birds have highly efficient respiratory systems due to haemoglobin with high oxygen affinity, extensive capillary networks, one-way air flow (no residual volume), and large air sacs."
    },
    {
        question: "A patient presents with symptoms of tissue hypoxia and has 'cherry-red' lips. Based on the provided information, which substance is most likely responsible?",
        options: [
            "Excessive carbon dioxide.",
            "Insufficient oxygen.",
            "Carbon monoxide.",
            "High levels of nitrogen."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: Carbon Monoxide (CO) poisoning leads to tissue hypoxia and 'cherry-red' lips, as CO binds to haemoglobin 249 times more readily than oxygen, preventing oxygen transport."
    },
    {
        question: "An individual experiences a reduced ability to filter dust and pathogens from inhaled air. Which specific part of the upper respiratory tract's defense mechanism is likely impaired?",
        options: [
            "The vocal cords in the larynx.",
            "The C-shaped cartilages in the trachea.",
            "The mucous membranes and cilia in the nasal cavities.",
            "The epiglottis preventing food entry."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: Nose hairs, mucus, and cilia in the nasal cavities filter out pathogens, dust, and particulate matter. Impairment of these would reduce filtering ability."
    },
    {
        question: "If the C-shaped cartilage pieces in the trachea were to become a continuous, rigid ring, what would be the most likely negative consequence?",
        options: [
            "Enhanced flexibility for head movements.",
            "Obstruction of the esophagus located posteriorly.",
            "Improved airflow due to increased rigidity.",
            "Reduced warming and moistening of inhaled air."
        ],
        correctAnswer: 1,
        reasoning: "The Book theory State that: The trachea is reinforced with 15-20 C-shaped cartilage pieces (open posteriorly) to prevent collapse. If they were a continuous ring, they would press on the posteriorly located esophagus, potentially obstructing swallowing. The open posterior design allows for esophageal expansion during food passage."
    },
    {
        question: "During a respiratory illness, surfactant production is severely diminished. What is the most direct and critical physiological consequence?",
        options: [
            "Increased resistance in the bronchioles.",
            "Impaired warming and moistening of inhaled air.",
            "Collapse of alveoli and reduced gas exchange.",
            "Decreased oxygen-carrying capacity of haemoglobin."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: Surfactant is a lipoprotein secreted by alveolar cells that lowers surface tension and prevents alveolar collapse. Diminished surfactant would directly lead to alveolar collapse and thus reduced gas exchange."
    },
    {
        question: "A patient is struggling to exhale forcibly after normal breathing. Which muscles are primarily impaired if they cannot contribute to this process?",
        options: [
            "Diaphragm and external intercostals.",
            "External intercostals only.",
            "Internal intercostals and abdominal muscles.",
            "Pectoralis major and sternocleidomastoid."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: Expiration is normally passive, but in forced exhalation, internal intercostal muscles contract, and abdominal muscles also contribute to actively push air out. If these are impaired, forcible exhalation would be difficult."
    },
    {
        question: "An athlete performs high-intensity, anaerobic exercise. Which respiratory pigment would be crucial for releasing stored oxygen to muscle cells when haemoglobin's supply is exhausted?",
        options: [
            "Haemoglobin.",
            "Oxyhaemoglobin.",
            "Carbaminohaemoglobin.",
            "Myoglobin."
        ],
        correctAnswer: 3,
        reasoning: "The Book theory State that: Myoglobin acts as an oxygen store in muscles, releasing oxygen when PO2 is very low (below 20 mmHg), especially when haemoglobin's oxygen supply is exhausted. This scenario fits high-intensity, anaerobic exercise."
    },
    {
        question: "If an individual develops a chronic condition that causes the permanent damage of air sacs, what specific respiratory disorder is most likely occurring?",
        options: [
            "Chronic bronchitis.",
            "Pneumonia.",
            "Asthma.",
            "Emphysema."
        ],
        correctAnswer: 3,
        reasoning: "The Book theory State that: Smoking leads to permanent damage of air sacs (alveoli), which is a characteristic of emphysema."
    },
    {
        question: "A scuba diver is using a breathing mixture with 35% O2 and 65% N2. This specialized gas mixture, mentioned in the context of SCUBA, is specifically called:",
        options: [
            "Pure air.",
            "Heliox.",
            "Nitrox.",
            "Trimix."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: SCUBA (Self-Contained Underwater Breathing Apparatus): Aqualungs use compressed air or Nitrox (e.g., 35% O2, 65% N2) for underwater breathing."
    },
    {
        question: "Considering the properties required for an efficient respiratory surface, what is the primary benefit of having a good blood supply?",
        options: [
            "To keep the surface moist and permeable.",
            "To maintain the thinness of the membrane.",
            "To facilitate efficient transport of gases away from or to the surface.",
            "To increase the overall surface area for diffusion."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: A Good Blood Supply is a property of the respiratory surface to facilitate efficient transport of gases."
    },
    {
        question: "An increase in the partial pressure of oxygen (PO2) in the lungs leads to increased oxygen binding to haemoglobin. Conversely, a decrease in PO2 in active tissues leads to oxygen dissociation. What is the fundamental concept governing this reversible binding?",
        options: [
            "The pH effect on haemoglobin structure.",
            "The temperature-dependent stability of oxyhaemoglobin.",
            "Oxygen Carrying Capacity, directly proportional to PO2.",
            "The role of carbonic anhydrase in CO2 transport."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: Oxygen Carrying Capacity is the ability of haemoglobin to bind oxygen, directly proportional to the partial pressure of oxygen (PO2). The Oxygen-Haemoglobin Dissociation Curve illustrates that higher PO2 (e.g., in lungs) leads to more oxygen binding to haemoglobin, while lower PO2 (e.g., in tissues) leads to oxygen dissociation and release."
    },
    {
        question: "During the transport of CO2, H+ ions are formed in red blood cells. What specific component inside the RBCs prevents a significant drop in blood pH due to these ions?",
        options: [
            "Carbonic anhydrase.",
            "Plasma proteins.",
            "Chloride ions.",
            "Haemoglobin."
        ],
        correctAnswer: 3,
        reasoning: "The Book theory State that: H2CO3 then dissociates into H+ and HCO3-. Haemoglobin buffers the H+ ions, preventing significant pH drop. This buffering action is critical for pH regulation during CO2 transport."
    },
    {
        question: "Why is haemoglobin considered to have a lower affinity for oxygen compared to myoglobin, especially in the context of oxygen release?",
        options: [
            "Haemoglobin consists of only one polypeptide chain.",
            "Haemoglobin loses oxygen at a higher partial pressure (e.g., 60 mmHg) compared to myoglobin.",
            "Haemoglobin is found in muscles, storing oxygen for emergency use.",
            "Haemoglobin binds only one oxygen molecule, limiting its capacity."
        ],
        correctAnswer: 1,
        reasoning: "The Book theory State that: Haemoglobin loses oxygen at a higher PO2 (e.g., 60 mmHg) compared to myoglobin. Less affinity for oxygen. Myoglobin has higher affinity for oxygen and releases oxygen when PO2 is very low (below 20 mmHg)."
    },
    {
        question: "A person is suspected of having a damaged medulla oblongata due to trauma. What direct consequence on their breathing control would be most immediately life-threatening?",
        options: [
            "Inability to voluntarily hold their breath.",
            "Reduced capacity to sing or speak loudly.",
            "Loss of involuntary breathing rhythm and depth.",
            "Impaired ability to sneeze or cough forcefully."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: Breathing is largely an involuntary process, controlled by a breathing center in the medulla oblongata of the brain. Damage would lead to a loss of this essential involuntary control, which is immediately life-threatening."
    },
    {
        question: "Which specific division of the respiratory system is solely involved in respiratory function and not also shared with the digestive system?",
        options: [
            "Pharynx.",
            "Oropharynx.",
            "Nasopharynx.",
            "Laryngopharynx."
        ],
        correctAnswer: 2,
        reasoning: "The Book theory State that: The Pharynx is divided into Nasopharynx (respiratory function), Oropharynx (swallowing), and Laryngopharynx (where respiratory and digestive tracts diverge). Only the nasopharynx is indicated as having solely respiratory function here."
    }
];

// Constants
const QUIZ_ACCESS_CODE = "PreMium-A-12345";
const DEV_ACCESS_CODE = "Dev-WCW-001";
const ACADEMY_NAME = "WHITE COAT WORRIORS ";
const QUIZ_SUBJECT = "Respiration ";
const WEBSITE_LINK = "https://premiumdoctoracademy.com";
const WHATSAPP_CONTACT = "03287743851";
const WHATSAPP_COMMUNITY = "https://whatsapp.com/channel/0029VaFCIU6EquiOlXWcNR1X";
const TIME_PER_MCQ = 60;
const MARK_PER_MCQ = 1;
const NEGATIVE_MARKING = 0;

// Global state variables
let currentQuizId = 'WCW-BIO-01';
let quizData = quizData_WCW_BIO_01;
let currentQuestion = 0;
let userAnswers = Array(quizData.length).fill(null);
let timeLeft;
let questionTimeLeft;
let totalTimeInterval;
let questionTimeInterval;
let studentData = {};
let studentAccessCode = "";

// DOM elements
const questionNavEl = document.getElementById('question-nav');
const questionTextEl = document.getElementById('question-text');
const optionsContainerEl = document.getElementById('options-container');
const reasoningEl = document.getElementById('reasoning');
const reasoningTextEl = document.getElementById('reasoning-text');
const quizTitleEl = document.getElementById('quiz-title');
const quizSubjectEl = document.getElementById('quiz-subject');
const perMcqTimeEl = document.getElementById('per-mcq-time');
const totalTimerEl = document.getElementById('timer');
const questionTimerEl = document.getElementById('question-timer');
const quizProgressEl = document.getElementById('quiz-progress');
const studentInfoTable = document.getElementById('student-info-table');
const quizResultsTable = document.getElementById('quiz-results-table');
const allMcqsList = document.getElementById('all-mcqs-list');
const devPasswordInput = document.getElementById('developerPassword');
const devErrorBox = document.getElementById('dev-error-box');
const quizAccessCodeInput = document.getElementById('quizAccessCode');
const quizAccessErrorBox = document.getElementById('quiz-error-box');
const toggleDevPasswordIcon = document.getElementById('toggleDeveloperPassword');
const toggleQuizCodeIcon = document.getElementById('toggleQuizAccessCode');
const websiteLinkEl = document.getElementById('website-link');
const whatsappContactLinkEl = document.getElementById('whatsapp-contact-link');
const whatsappCommunityLinkEl = document.getElementById('whatsapp-community-link');
const reasoningBtn = document.getElementById('reasoning-btn');
const quizNotificationEl = document.getElementById('quiz-notification');
const notificationTitleEl = document.getElementById('notification-title');
const notificationMessageEl = document.getElementById('notification-message');
const notificationYesBtn = document.getElementById('notification-yes');
const notificationNoBtn = document.getElementById('notification-no');
const correctCountEl = document.getElementById('correct-count');
const incorrectCountEl = document.getElementById('incorrect-count');
const unansweredCountEl = document.getElementById('unanswered-count');
const performanceFillEl = document.getElementById('performance-fill');


/**
 * @description Sends data to the Google Apps Script endpoint.
 * @param {object} data - The payload containing type ('registration' or 'quiz_result') and data.
 */
function sendDataToSheet(data) {
    if (!SHEET_SCRIPT_URL || SHEET_SCRIPT_URL.includes('YOUR_DEPLOYED_WEB_APP_URL')) {
        console.error('SHEET_SCRIPT_URL is not configured. Data not sent to Google Sheet.');
        return Promise.resolve({ success: false, message: 'Script URL not configured.' });
    }

    return fetch(SHEET_SCRIPT_URL, {
        method: 'POST',
        // 'no-cors' is necessary for Apps Script to accept cross-origin POST requests from a web page
        mode: 'no-cors',
        cache: 'no-cache',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
    })
    .then(response => {
        // Cannot read response body with 'no-cors', assume request was sent successfully
        return { success: true, message: 'Request sent to Google Script.' };
    })
    .catch(error => {
        console.error('Sheet Data Send Error:', error);
        return { success: false, message: 'Failed to send request to Google Script.' };
    });
}


// Initialization
document.addEventListener('DOMContentLoaded', () => {
    const storedStudentData = localStorage.getItem('studentData');
    if (storedStudentData) {
        studentData = JSON.parse(storedStudentData);
        document.getElementById('studentName').value = studentData['Student Name'] || '';
        document.getElementById('fatherName').value = studentData['Father Name'] || '';
        document.getElementById('email').value = studentData['Email'] || '';
        document.getElementById('mobile').value = studentData['Mobile'] || '';
        document.getElementById('city').value = studentData['City'] || '';
    }
    const storedCode = localStorage.getItem('studentAccessCode');
    if (storedCode) {
        studentAccessCode = storedCode;
    }
    
    showPage('signin-page');
    
    if (toggleDevPasswordIcon) toggleDevPasswordIcon.addEventListener('click', () => togglePasswordVisibility('developerPassword', 'toggleDeveloperPassword'));
    if (toggleQuizCodeIcon) toggleQuizCodeIcon.addEventListener('click', () => togglePasswordVisibility('quizAccessCode', 'toggleQuizAccessCode'));
});

function showQuizNotification(title, message, type = 'info') {
    const allowedNotifications = ['Registration Successful', 'Access Granted', 
                                 'Quiz Completed!', 'Quiz Reset', 'Registration Error', 'Submission Error', 'Registration Warning'];
    
    if (!allowedNotifications.includes(title)) {
        return;
    }
    
    notificationTitleEl.textContent = title;
    notificationMessageEl.textContent = message;
    
    quizNotificationEl.classList.remove('warning', 'error');
    
    if (type === 'warning') {
        quizNotificationEl.classList.add('warning');
    } else if (type === 'error') {
        quizNotificationEl.classList.add('error');
    }
    
    quizNotificationEl.classList.add('show');
    
    setTimeout(() => {
        if (quizNotificationEl.classList.contains('show')) {
            hideQuizNotification();
        }
    }, 5000);
}

function hideQuizNotification() {
    quizNotificationEl.classList.remove('show');
}

function showPage(pageId) {
    const pages = document.querySelectorAll('.page');
    pages.forEach(page => page.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');
    document.querySelectorAll('.error-box, .success-box').forEach(el => el.style.display = 'none');
}

function togglePasswordVisibility(inputID, iconID) {
    const passwordInput = document.getElementById(inputID);
    const toggleIcon = document.getElementById(iconID);
    
    if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        toggleIcon.classList.remove('fa-eye-slash');
        toggleIcon.classList.add('fa-eye');
    } else {
        passwordInput.type = 'password';
        toggleIcon.classList.remove('fa-eye');
        toggleIcon.classList.add('fa-eye-slash');
    }
}

function showQuizAccessForm() {
    document.getElementById('quiz-access-form').style.display = 'flex';
    document.getElementById('developer-access-form').style.display = 'none';
}

function showDeveloperAccessForm() {
    document.getElementById('developer-access-form').style.display = 'flex';
    document.getElementById('quiz-access-form').style.display = 'none';
}

function showRegistrationPage() {
    showPage('registration-page');
}

// Registration Handler
function generateAccessCode(studentName, fatherName) {
    const studentInitials = studentName.split(' ').map(n => n[0]).join('').toUpperCase();
    const fatherInitials = fatherName.split(' ').map(n => n[0]).join('').toUpperCase();
    const uniqueId = Math.random().toString(36).substring(2, 7).toUpperCase();

    return `${ACADEMY_NAME.replace(/\s+/g, '-')}-${studentInitials}${fatherInitials}-${uniqueId}`;
}

function handleRegistration() {
    const sName = document.getElementById('studentName').value.trim();
    const fName = document.getElementById('fatherName').value.trim();
    const email = document.getElementById('email').value.trim();
    const mobile = document.getElementById('mobile').value.trim();
    const city = document.getElementById('city').value.trim();
    
    if (!sName || !fName || !email || !mobile || !city) {
        showQuizNotification('Registration Error', 'Please fill in all the registration details.', 'error');
        return;
    }
    
    // Generate access code
    const generatedCode = generateAccessCode(sName, fName);
    studentAccessCode = generatedCode;

    studentData = {
        'Student Name': sName,
        'Father Name': fName,
        'Email': email,
        'Mobile': mobile,
        'City': city
    };

    // --- NEW: SEND REGISTRATION DATA TO GOOGLE SHEET ---
    const registrationDataToSend = {
        type: 'registration',
        accessCode: generatedCode,
        studentName: sName,
        fatherName: fName,
        email: email,
        mobile: mobile,
        city: city
    };
    
    sendDataToSheet(registrationDataToSend)
        .then(response => {
            console.log('Sheet Registration Response:', response);
            showQuizNotification('Registration Successful', `Your code: ${generatedCode}. Data submitted to sheet.`, 'info');
        })
        .catch(error => {
            console.error('Sheet Registration Error:', error);
            showQuizNotification('Registration Warning', `Registration saved locally, but sheet submission failed.`, 'warning');
        });
    // ----------------------------------------------------
    
    // Store data locally
    localStorage.setItem('studentAccessCode', generatedCode);
    localStorage.setItem('studentData', JSON.stringify(studentData));
    
    const registrations = JSON.parse(localStorage.getItem('wcwRegistrations') || '[]');
    registrations.push({
        ...studentData,
        accessCode: generatedCode,
        timestamp: new Date().toISOString()
    });
    localStorage.setItem('wcwRegistrations', JSON.stringify(registrations));
    
    
    // Start the quiz after registration
    startQuiz('WCW-BIO-01', 'Student', generatedCode);
}

// Quiz Access Handler
function checkDeveloperPassword() {
    devErrorBox.style.display = 'none';
    if (devPasswordInput.value === DEV_ACCESS_CODE) {
        showQuizNotification('Access Granted', 'Welcome! You have successfully logged in as a developer.', 'info');
        startQuiz('WCW-BIO-01', 'Developer', DEV_ACCESS_CODE);
    } else {
        devErrorBox.style.display = 'block';
    }
}

function accessQuiz(inputCode) {
    const errorBox = document.getElementById('quiz-error-box');
    errorBox.style.display = 'none';
    
    const storedStudentCode = localStorage.getItem('studentAccessCode');
    
    if (inputCode === QUIZ_ACCESS_CODE || inputCode === DEV_ACCESS_CODE || inputCode === storedStudentCode) {
        showQuizNotification('Access Granted', 'Welcome! You can now start the quiz.', 'info');
        startQuiz('WCW-BIO-01', 'Student', inputCode);
    } else {
        errorBox.style.display = 'block';
    }
}

function startQuiz(quizId, userType, code) {
    currentQuizId = quizId;
    quizData = quizData_WCW_BIO_01;
    
    // Always start fresh - no progress restoration
    currentQuestion = 0;
    userAnswers = Array(quizData.length).fill(null);
    
    timeLeft = quizData.length * TIME_PER_MCQ;
    questionTimeLeft = TIME_PER_MCQ;
    
    localStorage.setItem('lastAccessCode', code);

    showPage('quiz-page');
    initQuiz();
}

// Quiz Logic
function initQuiz() {
    quizSubjectEl.textContent = QUIZ_SUBJECT;
    perMcqTimeEl.textContent = Math.floor(TIME_PER_MCQ / 60);
    
    websiteLinkEl.href = WEBSITE_LINK;
    whatsappContactLinkEl.href = 'https://wa.me/' + WHATSAPP_CONTACT;
    whatsappCommunityLinkEl.href = WHATSAPP_COMMUNITY;
    
    quizTitleEl.textContent = `Test - ID: ${currentQuizId}`;
    renderQuestionNav();
    renderQuestion();

    if (totalTimeInterval) clearInterval(totalTimeInterval);
    if (questionTimeInterval) clearInterval(questionTimeInterval);
    
    totalTimeInterval = setInterval(updateTotalTimer, 1000);
    questionTimeInterval = setInterval(updateQuestionTimer, 1000);
}

function updateTotalTimer() {
    if (timeLeft > 0) {
        timeLeft--;
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        totalTimerEl.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    } else {
        clearInterval(totalTimeInterval);
        submitTest(true);
    }
}

function updateQuestionTimer() {
    if (questionTimeLeft > 0) {
        questionTimeLeft--;
        questionTimerEl.textContent = `${questionTimeLeft}`;
    } else {
        questionTimeLeft = TIME_PER_MCQ;
        navigateQuestion('next');
    }
}

function renderQuestionNav() {
    questionNavEl.innerHTML = '';
    quizData.forEach((_, index) => {
        const navItem = document.createElement('div');
        navItem.classList.add('question-nav-item');
        navItem.textContent = index + 1;
        navItem.onclick = () => navigateQuestion(index);
        
        if (index === currentQuestion) {
            navItem.classList.add('current');
        } else if (userAnswers[index] !== null) {
            navItem.classList.add('solved');
        } else if (userAnswers.slice(0, index).some(ans => ans !== null) || index < currentQuestion) {
             navItem.classList.add('visited');
        }
        
        questionNavEl.appendChild(navItem);
    });
    updateProgressBar();
}

function updateProgressBar() {
    const solvedCount = userAnswers.filter(answer => answer !== null).length;
    const progress = (solvedCount / quizData.length) * 100;
    quizProgressEl.style.width = `${progress}%`;
}

function renderQuestion() {
    reasoningEl.style.display = 'none';
    reasoningBtn.classList.add('disabled');
    const question = quizData[currentQuestion];
    questionTextEl.textContent = `${currentQuestion + 1}. ${question.question}`;
    
    optionsContainerEl.innerHTML = '';
    question.options.forEach((option, index) => {
        const optionEl = document.createElement('div');
        optionEl.classList.add('option');
        optionEl.textContent = option;
        
        const isAnswered = userAnswers[currentQuestion] !== null;

        if (!isAnswered) {
            optionEl.onclick = () => selectOption(index);
        } else {
            if (index === question.correctAnswer) {
                optionEl.classList.add('correct');
            } else if (index === userAnswers[currentQuestion]) {
                optionEl.classList.add('incorrect');
            }
        }
        
        if (userAnswers[currentQuestion] === index) {
            optionEl.classList.add('selected');
        }

        optionsContainerEl.appendChild(optionEl);
    });
    
    questionTimeLeft = TIME_PER_MCQ;
    questionTimerEl.textContent = `${questionTimeLeft}`;
    renderQuestionNav();
    
    if (userAnswers[currentQuestion] !== null) {
        reasoningBtn.classList.remove('disabled');
    }
}

function selectOption(optionIndex) {
    const question = quizData[currentQuestion];
    userAnswers[currentQuestion] = optionIndex;
    
    reasoningBtn.classList.remove('disabled');
    
    const options = optionsContainerEl.querySelectorAll('.option');
    options.forEach((option, index) => {
        option.onclick = null;
        option.classList.remove('selected', 'correct', 'incorrect');
        
        if (index === question.correctAnswer) {
            option.classList.add('correct');
        } else if (index === optionIndex) {
            option.classList.add('incorrect');
        }
        
        if (index === optionIndex) {
             option.classList.add('selected');
        }
    });

    renderQuestionNav();
    
    setTimeout(() => {
        navigateQuestion('next');
    }, 800);
}

function navigateQuestion(direction) {
    const totalQuestions = quizData.length;
    let nextIndex;

    if (typeof direction === 'number') {
        nextIndex = direction;
    } else if (direction === 'next') {
        nextIndex = (currentQuestion + 1) % totalQuestions;
    } else if (direction === 'prev') {
        nextIndex = (currentQuestion - 1 + totalQuestions) % totalQuestions;
    } else {
        return;
    }

    if (nextIndex === currentQuestion) return;
    
    currentQuestion = nextIndex;
    renderQuestion();
}

function toggleReasoning() {
    if (reasoningBtn.classList.contains('disabled')) return;
    
    const question = quizData[currentQuestion];
    if (reasoningEl.style.display === 'block') {
        reasoningEl.style.display = 'none';
    } else {
        reasoningTextEl.textContent = question.reasoning;
        reasoningEl.style.display = 'block';
    }
}

function submitTest(isTimeout = false) {
    if (!isTimeout && !confirm('Are you sure you want to submit the quiz?')) {
        return;
    }
    
    clearInterval(totalTimeInterval);
    clearInterval(questionTimeInterval);

    let correct = 0;
    let incorrect = 0;
    let unanswered = 0;

    quizData.forEach((question, index) => {
        if (userAnswers[index] === null) {
            unanswered++;
        } else if (userAnswers[index] === question.correctAnswer) {
            correct++;
        } else {
            incorrect++;
        }
    });

    const totalQuestions = quizData.length;
    const totalScore = (correct * MARK_PER_MCQ) - (incorrect * NEGATIVE_MARKING);
    const totalMarks = totalQuestions * MARK_PER_MCQ;

    correctCountEl.textContent = correct;
    incorrectCountEl.textContent = incorrect;
    unansweredCountEl.textContent = unanswered;
    
    const performancePercentage = (correct / totalQuestions) * 100;
    performanceFillEl.style.width = `${performancePercentage}%`;

    const savedStudentData = JSON.parse(localStorage.getItem('studentData') || '{}');
    const lastAccessCode = localStorage.getItem('lastAccessCode') || 'N/A';
    
    let studentInfoHtml = '';
    for (const [key, value] of Object.entries(savedStudentData)) {
        studentInfoHtml += `<tr><td>${key}</td><td>${value}</td></tr>`;
    }
    studentInfoHtml += `<tr><td>Access Code Used</td><td>${lastAccessCode}</td></tr>`;
    studentInfoTable.innerHTML = studentInfoHtml;

    quizResultsTable.innerHTML = `
        <tr><td>Quiz ID</td><td>${currentQuizId}</td></tr>
        <tr><td>Total Questions</td><td>${totalQuestions}</td></tr>
        <tr><td>Correct Answers</td><td>${correct}</td></tr>
        <tr><td>Incorrect Answers</td><td>${incorrect}</td></tr>
        <tr><td>Unanswered</td><td>${unanswered}</td></tr>
        <tr><td>Your Score</td><td>${totalScore} / ${totalMarks}</td></tr>
    `;

    // --- NEW: SEND QUIZ RESULTS TO GOOGLE SHEET ---
    if (lastAccessCode && lastAccessCode !== 'N/A') {
        const resultsDataToSend = {
            type: 'quiz_result',
            accessCode: lastAccessCode,
            quizId: currentQuizId,
            totalQuestions: totalQuestions,
            correct: correct,
            incorrect: incorrect,
            unanswered: unanswered,
            totalScore: totalScore,
            totalMarks: totalMarks,
            studentName: savedStudentData['Student Name'] || 'Unknown' 
        };

        sendDataToSheet(resultsDataToSend)
            .then(response => {
                console.log('Sheet Results Update Response:', response);
            })
            .catch(error => {
                console.error('Sheet Results Update Error:', error);
                showQuizNotification('Submission Error', 'Failed to send results to the server sheet.', 'error');
            });
    }
    // ----------------------------------------------------


    const results = JSON.parse(localStorage.getItem('wcwQuizResults') || '[]');
    results.push({
        studentName: savedStudentData['Student Name'] || 'Unknown',
        accessCode: lastAccessCode,
        quizId: currentQuizId,
        totalQuestions: totalQuestions,
        correct: correct,
        incorrect: incorrect,
        unanswered: unanswered,
        totalScore: totalScore,
        totalMarks: totalMarks,
        timestamp: new Date().toISOString()
    });
    localStorage.setItem('wcwQuizResults', JSON.stringify(results));
    
    showQuizNotification('Quiz Completed!', `Your score: ${totalScore}/${totalMarks}. Check the results page for details.`, 'info');
    
    showPage('results-page');
}

function restartTest() {
    if (confirm('Are you sure you want to retake the full test? Your current progress will be lost.')) {
        quizData = quizData_WCW_BIO_01;
        currentQuestion = 0;
        userAnswers = Array(quizData.length).fill(null);
        timeLeft = quizData.length * TIME_PER_MCQ;
        
        showPage('quiz-page');
        initQuiz();
    }
}

function retakeIncorrect() {
    const incorrectIndices = quizData.map((question, index) => {
        const isIncorrect = userAnswers[index] !== null && 
                            userAnswers[index] !== question.correctAnswer;
        return isIncorrect ? index : -1;
    }).filter(index => index !== -1);
    
    if (incorrectIndices.length === 0) {
        showQuizNotification('No Incorrect Questions', 'You have no incorrect questions to retake!', 'info');
        return;
    }
    
    quizData = incorrectIndices.map(index => quizData_WCW_BIO_01[index]);
    currentQuestion = 0;
    userAnswers = Array(quizData.length).fill(null);
    timeLeft = quizData.length * TIME_PER_MCQ;
    
    showPage('quiz-page');
    initQuiz();
}

function viewAllMcqs() {
    allMcqsList.innerHTML = '';
    quizData_WCW_BIO_01.forEach((question, index) => {
        const mcqItem = document.createElement('div');
        mcqItem.classList.add('all-mcq-item');
        mcqItem.innerHTML = `
            <div class="question-text">${index + 1}. ${question.question}</div>
            <div class="all-mcq-options">
                ${question.options.map((option, optIndex) => `
                    <div class="all-mcq-option ${optIndex === question.correctAnswer ? 'correct' : ''}">
                        ${option}
                    </div>
                `).join('')}
            </div>
            <div class="all-mcq-reasoning">
                <strong>Reasoning:</strong> ${question.reasoning}
            </div>
        `;
        allMcqsList.appendChild(mcqItem);
    });
    showPage('all-mcqs-page');
}</script>